distances, indices = knn.kneighbors( (1-sim).loc[[uid]] )
neighbors = sim.index[indices[0]][1:]

INITIALIZE ubcf_raw = {}
FOR cid IN mat.columns DO
    IF mat.loc[uid, cid] == 0 THEN 
        num_ = 0.0
        den_ = 0.0
        FOR v IN neighbors DO
            num_ += sim.loc[uid, v] * mat.loc[v, cid]
            den_ += abs(sim.loc[uid, v])
        END FOR

        IF den_ > 0 THEN
            val = num_ / den_
            if val > 0: ubcf_raw[cid] = val
        END IF
    END IF
END FOR

cf_norm = robust_normalize(ubcf_raw)
