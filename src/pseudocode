num = X.dot(X.Transpose)          
norm = sqrt( (X**2).sum(axis=1) ) 
den = outer_product(norm, norm) + 1e-8
sim_vals = num / den              
sim = clip(sim_vals, -1, 1)     

dist = 1 - sim                    
knn = NearestNeighbors(metric="precomputed", n_neighbors=7) 
knn.fit(dist.values)              